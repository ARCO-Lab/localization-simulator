
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../helper/">
      
      
        <link rel="next" href="../trajectory/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.3.2">
    
    
      
        <title>Newton Solver - Localization Simulator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.30068a00.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#localization_simulator.utils.nls" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Localization Simulator" class="md-header__button md-logo" aria-label="Localization Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Localization Simulator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Newton Solver
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Localization Simulator" class="md-nav__button md-logo" aria-label="Localization Simulator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Localization Simulator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    main
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../component/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    component
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../error/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    error
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    map
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    plot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../helper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    helper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Newton Solver
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Newton Solver
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls" class="md-nav__link">
    nls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS" class="md-nav__link">
    NLS
  </a>
  
    <nav class="md-nav" aria-label="NLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.addNoise" class="md-nav__link">
    addNoise()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.eq" class="md-nav__link">
    eq()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.estimatePose" class="md-nav__link">
    estimatePose()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.process" class="md-nav__link">
    process()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../trajectory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    trajectory
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls" class="md-nav__link">
    nls
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS" class="md-nav__link">
    NLS
  </a>
  
    <nav class="md-nav" aria-label="NLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.addNoise" class="md-nav__link">
    addNoise()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.eq" class="md-nav__link">
    eq()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.estimatePose" class="md-nav__link">
    estimatePose()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localization_simulator.utils.nls.NLS.process" class="md-nav__link">
    process()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Newton Solver</h1>

<div class="doc doc-object doc-module">



<a id="localization_simulator.utils.nls"></a>
  <div class="doc doc-contents first">
  
      <p>A module for using Newtons method to approximate position at a given pose using the norm of the gradient.</p>

<details class="todo" open>
  <summary>Todo</summary>
  <ul>
<li>Potentially look at adding a dampening factor in case of instability or excessive oscillation.</li>
<li>Do more to decouple nls from maps.</li>
</ul>
</details>
  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="localization_simulator.utils.nls.NLS" class="doc doc-heading">
          <code>NLS</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Newton solver for approximating the solution the solution at a given timestep.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>points</code></td>
          <td>
                <code>list[list[<span title="numpy.ndarray">ndarray</span>[float]]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>All initial and subsequent approximations for each timestep.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>gradNorms</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Gradient norms for the intial and subsequent approximations for each timestep.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>anchors</code></td>
          <td>
                <code>list[tuple[float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Locations of each anchor (either 2D or 3D).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>variance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The variance to be used for adding noise to measurements.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>tolerance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the maximum error before Newtons method stops iterating.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>localization_simulator/utils/nls.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NLS</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Newton solver for approximating the solution the solution at a given timestep.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        points (list[list[numpy.ndarray[float]]]): All initial and subsequent approximations for each timestep.</span>
<span class="sd">        gradNorms (list[list[float]]): Gradient norms for the intial and subsequent approximations for each timestep.</span>
<span class="sd">        anchors (list[tuple[float]]): Locations of each anchor (either 2D or 3D).</span>
<span class="sd">        variance (float): The variance to be used for adding noise to measurements.</span>
<span class="sd">        tolerance (float): the maximum error before Newtons method stops iterating.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">gradNorms</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Init method</span>

<span class="sd">        Args:</span>
<span class="sd">            points (list[list[numpy.ndarray[float]]]): All initial and subsequent approximations for each timestep.</span>
<span class="sd">            gradNorms (list[list[float]]): Gradient norms for the intial and subsequent approximations for each timestep.</span>
<span class="sd">            anchors (list[tuple[float]]): Locations of each anchor (either 2D or 3D).</span>
<span class="sd">            variance (float): The variance to be used for adding noise to measurements.</span>
<span class="sd">            tolerance (float): the maximum error before Newtons method stops iterating.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradNorms</span> <span class="o">=</span> <span class="n">gradNorms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span> <span class="o">=</span> <span class="n">anchors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">variance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>

    <span class="k">def</span> <span class="nf">addNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add noise to distance measurements.</span>

<span class="sd">        Gaussian noise with a mean of 0 and a standard deviation determined by the specified variance is then added to</span>
<span class="sd">        these distances to simulate measurement noise.</span>

<span class="sd">        Args:</span>
<span class="sd">            pose (numpy.ndarray[float]): The current pose of the robot</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray[float]): Noisy distance measurements from the robot to each anchor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pose</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">noisy_distances</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">noisy_distances</span>

    <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">est_pose</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Calculates the Euclidean distances from anchor points to given pose.</span>

<span class="sd">        Used as part of the objective function.</span>

<span class="sd">        Args:</span>
<span class="sd">            est_pose (numpy.ndarray[float]s): The pose estimate</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray[float]):  Euclidean distances from the estimated pose to each anchor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">est_x</span><span class="p">,</span> <span class="n">est_y</span> <span class="o">=</span> <span class="n">est_pose</span>
        <span class="n">est_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">est_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">est_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">est_distances</span>

    <span class="c1"># Using Newtons method and autograd for gradient and hessian</span>
    <span class="k">def</span> <span class="nf">estimatePose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">est_pose</span><span class="p">,</span> <span class="n">measurements</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate the pose using Newtons method. </span>

<span class="sd">        Given an initial estimated pose and distance measurements, the method iteratively updates the estimated</span>
<span class="sd">        pose using Newton&#39;s method. The error function is defined as the squared sum of differences between the estimated</span>
<span class="sd">        distances and the actual measurements. Autograd is utilized to calculate the gradient and hessian of this error</span>
<span class="sd">        function with respect to the estimated pose.</span>

<span class="sd">        Args:</span>
<span class="sd">            est_pose (numpy.ndarray[float]): The pose estimate</span>
<span class="sd">            measurements (numpy.ndarray[float]): The noisy measurments from the pose to anchors</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple[numpy.ndarray[float], float]): The updated estimated pose and the norm of the gradient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">est_x</span><span class="p">,</span> <span class="n">est_y</span> <span class="o">=</span> <span class="n">est_pose</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">measurements</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))(</span><span class="n">est_pose</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">measurements</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))(</span><span class="n">est_pose</span><span class="p">)</span>

        <span class="n">h_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">delta_pose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">h_inv</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

        <span class="n">est_x</span> <span class="o">-=</span> <span class="n">delta_pose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">est_y</span> <span class="o">-=</span> <span class="n">delta_pose</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">est_x</span><span class="p">,</span> <span class="n">est_y</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform Newtons method to refine an intial guess for the pose based on distance measurements until a tolerance is met.</span>

<span class="sd">        Args:</span>
<span class="sd">            pose (numpy.ndarray[float]): The actual pose</span>
<span class="sd">            guess (numpy.ndarray[float]): The intial guess for a given poses. A randomly determined point on the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">measurements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNoise</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>
            <span class="n">guess</span><span class="p">,</span> <span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimatePose</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">measurements</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
            <span class="n">grads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grad</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradNorms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="localization_simulator.utils.nls.NLS.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">gradNorms</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Init method</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>points</code></td>
          <td>
                <code>list[list[<span title="numpy.ndarray">ndarray</span>[float]]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>All initial and subsequent approximations for each timestep.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>gradNorms</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Gradient norms for the intial and subsequent approximations for each timestep.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>anchors</code></td>
          <td>
                <code>list[tuple[float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Locations of each anchor (either 2D or 3D).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>variance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The variance to be used for adding noise to measurements.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tolerance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the maximum error before Newtons method stops iterating.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>localization_simulator/utils/nls.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">gradNorms</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Init method</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[list[numpy.ndarray[float]]]): All initial and subsequent approximations for each timestep.</span>
<span class="sd">        gradNorms (list[list[float]]): Gradient norms for the intial and subsequent approximations for each timestep.</span>
<span class="sd">        anchors (list[tuple[float]]): Locations of each anchor (either 2D or 3D).</span>
<span class="sd">        variance (float): The variance to be used for adding noise to measurements.</span>
<span class="sd">        tolerance (float): the maximum error before Newtons method stops iterating.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gradNorms</span> <span class="o">=</span> <span class="n">gradNorms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span> <span class="o">=</span> <span class="n">anchors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">variance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="localization_simulator.utils.nls.NLS.addNoise" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">addNoise</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add noise to distance measurements.</p>
<p>Gaussian noise with a mean of 0 and a standard deviation determined by the specified variance is then added to
these distances to simulate measurement noise.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pose</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The current pose of the robot</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Noisy distance measurements from the robot to each anchor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>localization_simulator/utils/nls.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">addNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add noise to distance measurements.</span>

<span class="sd">    Gaussian noise with a mean of 0 and a standard deviation determined by the specified variance is then added to</span>
<span class="sd">    these distances to simulate measurement noise.</span>

<span class="sd">    Args:</span>
<span class="sd">        pose (numpy.ndarray[float]): The current pose of the robot</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray[float]): Noisy distance measurements from the robot to each anchor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pose</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">noisy_distances</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">noisy_distances</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="localization_simulator.utils.nls.NLS.eq" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">eq</span><span class="p">(</span><span class="n">est_pose</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculates the Euclidean distances from anchor points to given pose.</p>
<p>Used as part of the objective function.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>est_pose</code></td>
          <td>
                <code>numpy.ndarray[float]s</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The pose estimate</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Euclidean distances from the estimated pose to each anchor</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>localization_simulator/utils/nls.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">est_pose</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculates the Euclidean distances from anchor points to given pose.</span>

<span class="sd">    Used as part of the objective function.</span>

<span class="sd">    Args:</span>
<span class="sd">        est_pose (numpy.ndarray[float]s): The pose estimate</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray[float]):  Euclidean distances from the estimated pose to each anchor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">est_x</span><span class="p">,</span> <span class="n">est_y</span> <span class="o">=</span> <span class="n">est_pose</span>
    <span class="n">est_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">est_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">est_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">est_distances</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="localization_simulator.utils.nls.NLS.estimatePose" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">estimatePose</span><span class="p">(</span><span class="n">est_pose</span><span class="p">,</span> <span class="n">measurements</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Estimate the pose using Newtons method. </p>
<p>Given an initial estimated pose and distance measurements, the method iteratively updates the estimated
pose using Newton's method. The error function is defined as the squared sum of differences between the estimated
distances and the actual measurements. Autograd is utilized to calculate the gradient and hessian of this error
function with respect to the estimated pose.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>est_pose</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The pose estimate</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>measurements</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The noisy measurments from the pose to anchors</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple[<span title="numpy.ndarray">ndarray</span>[float], float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The updated estimated pose and the norm of the gradient.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>localization_simulator/utils/nls.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">estimatePose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">est_pose</span><span class="p">,</span> <span class="n">measurements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the pose using Newtons method. </span>

<span class="sd">    Given an initial estimated pose and distance measurements, the method iteratively updates the estimated</span>
<span class="sd">    pose using Newton&#39;s method. The error function is defined as the squared sum of differences between the estimated</span>
<span class="sd">    distances and the actual measurements. Autograd is utilized to calculate the gradient and hessian of this error</span>
<span class="sd">    function with respect to the estimated pose.</span>

<span class="sd">    Args:</span>
<span class="sd">        est_pose (numpy.ndarray[float]): The pose estimate</span>
<span class="sd">        measurements (numpy.ndarray[float]): The noisy measurments from the pose to anchors</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple[numpy.ndarray[float], float]): The updated estimated pose and the norm of the gradient.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">est_x</span><span class="p">,</span> <span class="n">est_y</span> <span class="o">=</span> <span class="n">est_pose</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">measurements</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))(</span><span class="n">est_pose</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">measurements</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))(</span><span class="n">est_pose</span><span class="p">)</span>

    <span class="n">h_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">delta_pose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">h_inv</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

    <span class="n">est_x</span> <span class="o">-=</span> <span class="n">delta_pose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">est_y</span> <span class="o">-=</span> <span class="n">delta_pose</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">est_x</span><span class="p">,</span> <span class="n">est_y</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="localization_simulator.utils.nls.NLS.process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform Newtons method to refine an intial guess for the pose based on distance measurements until a tolerance is met.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pose</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The actual pose</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>guess</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The intial guess for a given poses. A randomly determined point on the map.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>localization_simulator/utils/nls.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform Newtons method to refine an intial guess for the pose based on distance measurements until a tolerance is met.</span>

<span class="sd">    Args:</span>
<span class="sd">        pose (numpy.ndarray[float]): The actual pose</span>
<span class="sd">        guess (numpy.ndarray[float]): The intial guess for a given poses. A randomly determined point on the map.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">measurements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNoise</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>
        <span class="n">guess</span><span class="p">,</span> <span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimatePose</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">measurements</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
        <span class="n">grads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grad</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gradNorms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>